---
layout: post
title: "如何使用GDB调试程序"
description: ""
categories: 
- C
tags: [调试]
---
{% include JB/setup %}
　　
## GDB是什么 ##
　　GDB是GNU开源组织发布的一个linux 系统上常用的 c/c++ 调试工具。之前工作环境一直在windows下，所以对图形化的调试方法比较熟悉，开始接触GDB的时候，觉得这样的调试方法简直“不可思议”，但是现在用下来觉得有点地方还是比图形化的调试更强大一点。GDB可以更容易地跟踪错误。比那些使用猜测蒙混过关的人无限量的printf。GDB是一个命令行工具，这意味着你可以与它交互终端 通过键盘发出命令，而不是用你的鼠标点击按钮。


　　要启动GDB，你真的只是键入gdb的提示和命中输入。 你会看到一些在屏幕上打印出来的你的版本，你正在运行的GDB， 它的版权信息，你会看到GDB提示：（GDB）。这让你知道，GDB准备的命令。在这一点上，最重要的是要知道该怎么退出。幸运的是，这是非常简单的。quit命令做到了这一点。作为一种快捷方式，你可以使用q。快速启动GDB，然后迅速退出，现在让我们来谈谈使用GDB调试程序。 

　　一般来说，GDB主要帮忙你完成下面五个方面的功能：

　　- 启动你的程序，可以按照你的自定义的要求随心所欲的运行程序。  
　　- 可让被调试的程序在你所指定的调置的断点处停住。（断点可以是条件表达式）。  
　　- 当程序被停住时，用户可以随时查看程序中各表达式、变量值以及内存值。  
　　- 程序暂停时用户可以进行单步调试，依此检查程序每步运行的结果是否跟预测值一致，并且可以检查每步出现的错误。  
　　- 动态的改变你程序的执行环境，用户可以改变程序中的变量或者执行顺序，来验证程序是否正确。

## GDB简单使用 ##
我们以一个简单例子来了解一下GDB的执行流程。下面一段代码是我翻之前的博客找到的。
{% highlight c++ %}
#include "stdio.h"
int main()
{
	char *charPtr = "I am the pointer of a string\n";
	int i = 10;
	double j = 3.14;
	int *intPtr =&i;
	double *floatPtr = &j;
	void *temp;
	temp = charPtr;
	printf("%s",(char*)temp);
	temp = intPtr;
	printf("%d\n",*(int*)temp);
	temp = floatPtr;
	printf("%f\n",*(double*)temp);
	return 0;
}
{% endhighlight %}
首先我们编译下源码，在编译时，我们必须要把调试信息加到可执行文件中。使用编译器（cc/gcc/g++）的 -g 参数可以做到这一点。
并不是任何程序都可以使用GDB进行调试，要使用GDB进行调试必须满足两个条件：
（1）程序必须使用GCC进行编译，并且在编译过程中添加“-g”调试信息选项。
（2）要调试的可执行文件必须存在源程序代码，一般源程序代码存放的目录需要与可执行文件的目录相同。
以上两个条件缺一不可，如果不添加-g选项，GDB将不能获取调试信息；如果缺少源程序代码，GDB将不能加载源文件并显示错误信息。
在gcc编译时，因为使用优化会改变程序的运行结果，所以建议不要使用-O优化选项，这样才能使生成的可执行文件和源代码保持一一对应的关系；其次，用户如果想生成更多的调试信息，可在GCC编译时使用-ggdb选项。
运行命令  `gcc -g <文件名> -o <生成可执行文件名>`
然后启动GDB调试命令：`gdb <生成可执行文件名>` 。此时便进入了调试界面，屏幕上打印出来的你的版本，你正在运行的GDB， 它的版权信息等等。输入命令`list（l）`显示源码，便于你设置断点什么的。括号内为命令的缩写。  
![1](http://d.pcs.baidu.com/thumbnail/2be7e3fea984bf0428e51d27e47613f5?fid=859179042-250528-3730497141&time=1392727442&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-5pwBGukZfnW%2Bhs5ozb02T4TZ7vY%3D&expires=8h&prisign=RK9dhfZlTqV5TuwkO5ihMQzlM241kT2YfffnCZFTaEPwOxHv/XxtwRXLxDSXMBba1Ms9seOiqT9/QffwI8K2Baw0mmLABRQNl51b/oS8+InqoadADmwcyvUvQUkAvl8j879BObtgHePZ09BZiFo3CF7dwGcK/xIzausW8RTta6nycgI5A4W/Ju5XK/lbx40b7xvlT+8yG2JtdgCRiVnR1AJg/5Xtw3uHhGD0YL/AFRY=&r=555807554&size=c850_u580&quality=100)
然后我们在程序第8行设置断点：`break 8(b 8)`，接着开始运行程序`run（r）`，程序执行到第8行时便会停止，你可以查看变量的信息，堆栈的情况等等。比如要显示变量floatPtr的值，输入命令`print floatPtr(p floatPtr)`便可以看到变量的值。继续运行程序：`continue（c）`，直到程序运行结束。
![2](http://d.pcs.baidu.com/thumbnail/904302ec74b8179912bca8e07470e6f9?fid=859179042-250528-1123227070&time=1392727442&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-ExQm0kiPXUmqPnZYNfrRjpu5MQk%3D&expires=8h&prisign=RK9dhfZlTqV5TuwkO5ihMQzlM241kT2YfffnCZFTaEPwOxHv/XxtwRXLxDSXMBba1Ms9seOiqT9/QffwI8K2Baw0mmLABRQNl51b/oS8+InqoadADmwcyvUvQUkAvl8j879BObtgHePZ09BZiFo3CF7dwGcK/xIzausW8RTta6nycgI5A4W/Ju5XK/lbx40b7xvlT+8yG2JtdgCRiVnR1AJg/5Xtw3uHhGD0YL/AFRY=&r=871004922&size=c850_u580&quality=100)




## GDB基本命令 ##

## GDB设置断点 ##