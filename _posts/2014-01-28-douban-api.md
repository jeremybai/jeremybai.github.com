---
layout: post
title: "如何调用豆瓣API"
description: ""
categories: 
- Javascript
- JQuery
- web
tags: [豆瓣,API]
---
{% include JB/setup %}

　　最近在自己的网页中希望可以输入书籍的ISBN号就可以自动补全书籍的所有信息，人工输入工作量太大，就选择了调用豆瓣的API获得数据填写到表单中。做了两天才做好，网上有用的资料比较少，于是晒出自己这两天做的一些东西，希望可以帮助到需要的人，注意：APIV1.0和2.0是有区别的。在下面有提到，需要稍微留意。  
　　下面的代码实现的功能都是将ISBN号为9787543632608（片山恭一的[《满月之夜白鲸现》](http://book.douban.com/subject/1220562/)）的图书信息返回出来，只是使用的方法不一样而已，运行的结果如下图：  

![]({{site.img_url}}/doubanapi.jpg) 

## 1. JS调用 ##

　　通过豆瓣js中的函数来获得图书的信息。JS文件采用的是豆瓣的apiV2.0，不过返回出来结果和旧版的apiV1.0一样，返回的信息不是JSON格式，需要调用parseSubject函数来转为JSON对象。代码如下：



## 2. JQUERY调用 ##
　　替换上面代码的script标签里面的内容。getJSON函数的第一个参数为url，第二个为回调函数，即获取url的JSON数据之后执行的函数，这个url是老版本的apiV1.0，所以同上面一样，还是要调用parseSubject函数。



　　如果采用的是APIV2.0版，有些不同，首先getJSON函数url参数是新版的url，返回出来的数据格式就是JSON格式，不需要转换直接使用即可。有个问题，除了book.author可以加上.join(' / ')加上分隔符，其他参数加上这个函数就会出错，不知道什么原因。
    


##附：JSON格式 ##
　　关于JSON格式，这个是在网上看到阮一峰老师写的[博客](http://www.ruanyifeng.com/blog/2009/05/data_types_and_json.html)的，写的很好，一下子就理解了。

>　　从结构上看，所有的数据（data）最终都可以分解成三种类型：  
>　　第一种类型是**标量** （scalar），也就是一个单独的字符串（string）或数字（numbers），比如"北京"这个单独的词。  
>　　第二种类型是**序列** （sequence），也就是若干个相关的数据按照一定顺序并列在一起，又叫做数组（array）或列表（List），比如"北京，上海"。  
>　　第三种类型是**映射** （mapping），也就是一个名/值对（Name/value），即数据有一个名称，还有一个与之相对应的值，这又称作散列（hash）或字典（dictionary），比如"首都：北京"。  
>　　21世纪初，Douglas Crockford寻找一种简便的数据交换格式，能够在服务器之间交换数据。当时通用的数据交换语言是XML，但是Douglas Crockford觉得XML的生成和解析都太麻烦，所以他提出了一种简化格式，也就是Json。  
　　Json的规格非常简单，只用一个页面几百个字就能说清楚，而且Douglas Crockford声称这个规格永远不必升级，因为该规定的都规定了。  
>　　1） 并列的数据之间用逗号（", "）分隔。  
>　　2） 映射用冒号（": "）表示。  
>　　3） 并列数据的集合（数组）用方括号("[]")表示。  
>　　4） 映射的集合（对象）用大括号（"{}"）表示。  
>　　上面四条规则，就是Json格式的所有内容。  

